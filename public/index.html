<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>D&D Spell Cards</title>

    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="util.css">

    <!-- https://unpkg.com/mustache@latest/mustache.min.js -->
    <script src="../lib/mustache.min.js"></script>

    <!-- todo: put this in the lib folder? -->
    <!-- original reason not to, was because it makes onboarding easier. -->
    <!-- (using npm to manage packages, vs just clone this one dependency yourself) -->
    <script src="../../2024_MPMBs-Character-Record-Sheet/_functions/FunctionsImport.js"></script>
    <script src="../../2024_MPMBs-Character-Record-Sheet/_functions/Functions0.js"></script>
    <script src="../../2024_MPMBs-Character-Record-Sheet/_functions/Functions1.js"></script>
    <script src="../../2024_MPMBs-Character-Record-Sheet/_functions/Functions2.js"></script>
    <script src="../../2024_MPMBs-Character-Record-Sheet/_functions/Functions3.js"></script>
    <script src="../../2024_MPMBs-Character-Record-Sheet/_functions/FunctionsSpells.js"></script>
    <script src="../../2024_MPMBs-Character-Record-Sheet/_functions/FunctionsResources.js"></script>

    <script src="../src/mpmb-host.js"></script>

    <script src="../../2024_MPMBs-Character-Record-Sheet/_variables/Lists.js"></script>
    <script src="../../2024_MPMBs-Character-Record-Sheet/_variables/ListsSpells.js"></script>

    <!-- <script src="../2024_MPMBs-Character-Record-Sheet/_variables/ListsBackgrounds.js"></script> -->
    <!-- <script src="../2024_MPMBs-Character-Record-Sheet/_variables/ListsClasses.js"></script>-->
    <script src="../../2024_MPMBs-Character-Record-Sheet/_variables/ListsCompanions.js"></script>
    <script src="../../2024_MPMBs-Character-Record-Sheet/_variables/ListsCreatures.js"></script>
    <!--<script src="../2024_MPMBs-Character-Record-Sheet/_variables/ListsEvals.js"></script>
    <script src="../2024_MPMBs-Character-Record-Sheet/_variables/ListsFeats.js"></script>
    <script src="../2024_MPMBs-Character-Record-Sheet/_variables/ListsGear.js"></script>-->
    <script src="../../2024_MPMBs-Character-Record-Sheet/_variables/ListsMagicItems.js"></script>
    <!-- <script src="../2024_MPMBs-Character-Record-Sheet/_variables/ListsPsionics.js"></script>
    <script src="../2024_MPMBs-Character-Record-Sheet/_variables/ListsRaces.js"></script>
    <script src="../2024_MPMBs-Character-Record-Sheet/_variables/ListsSources.js"></script> -->

<body>
    <div id="app"></div>

    <template id="root-template">
        {{#sections}}
        <section>
            {{#spell-cards.pages}}
            <div class="page">
                <div class="grid grid-{{grid_size}}">
                    {{#cards}}
                    {{> spell-card}}
                    {{/cards}}
                </div>
            </div>
            {{/spell-cards.pages}}
        </section>
        <section>
            {{#monster-cards.pages}}
            <div class="page">
                <div class="grid grid-{{grid_size}}">
                    {{#cards}}
                    {{> monster-card}}
                    {{/cards}}
                </div>
            </div>
            {{/monster-cards.pages}}
        </section>
        {{/sections}}
    </template>

    <template id="character-sheet-template">
        <div class="page">
            <div>Name: {{name}}</div>
        </div>
    </template>

    <template id="spell-card-template">
        <div class="card spell-card" data-key="{{key}}">
            <div>
                <span class="name">{{name}}</span><br>
                <span class="subtitle">{{vm.subtitle}}</span><br>
            </div>

            <div class="summary">{{vm.summary}}</div>

            <div>
                <span class='label'>Casting Time: </span>{{vm.time}}<br>
                <span class='label'>Range: </span>{{vm.range}}<br>
                <span class='label'>Components: </span>{{vm.components}}<br>
                <span class='label'>Duration: </span>{{vm.duration}}<br>
            </div>

            <div>
                <span class="description">{{{vm.descriptionHtml}}}</span>
            </div>

            <div class="spacer"></div>

            <div class="source-book">
                {{vm.source}}
            </div>
        </div>
    </template>

    <template id="monster-card-template">
        <div class="card monster-card" data-key="{{key}}">
            <div class="row">
                <div class="name">{{name}}</div>
                <div class="subtitle">{{vm.subtitle}}</div>

                <hr />

                <div class="mb-1">
                    <div class="flex-row">
                        <div><span class="label">AC</span> {{ac}}</div>
                        <div><span class="label">Initiative</span> {{vm.initiative}}</div>
                    </div>
                    <div><span class="label">HP</span> {{hp}} {{vm.hit_dice}}</div>
                    <div><span class="label">Speed</span> {{speed}}</div>

                    <!-- todo: need to apply format_modifer() to the numbers -->
                    <div class="row flex-row my-1">
                        <div class="abilities-group">

                            <div class="ability header">
                                <div class=""></div>
                                <div class=""></div>
                                <div>MOD</div>
                                <div>SAVE</div>
                            </div>

                            <div class="ability">
                                {{#abilities.str}}
                                <div class="ability-abbr cell">Str</div>
                                <div class="cell">{{score}}</div>
                                <div class="cell">{{mod}}</div>
                                <div class="cell">{{save_mod}}</div>
                                {{/abilities.str}}
                            </div>

                            <div class="ability">
                                {{#abilities.int}}
                                <div class="ability-abbr cell">Int</div>
                                <div class="cell">{{score}}</div>
                                <div class="cell">{{mod}}</div>
                                <div class="cell">{{save_mod}}</div>
                                {{/abilities.int}}
                            </div>

                        </div><!--/abilities group -->

                        <div class="abilities-group">

                            <div class="ability header">
                                <div class=""></div>
                                <div class=""></div>
                                <div>MOD</div>
                                <div>SAVE</div>
                            </div>

                            {{#abilities.dex}}
                            <div class="ability">
                                <div class="ability-abbr cell">Dex</div>
                                <div class="cell">{{score}}</div>
                                <div class="cell">{{mod}}</div>
                                <div class="cell">{{save_mod}}</div>
                            </div>
                            {{/abilities.dex}}

                            <div class="ability">
                                {{#abilities.wis}}
                                <div class="ability-abbr cell">Wis</div>
                                <div class="cell">{{score}}</div>
                                <div class="cell">{{mod}}</div>
                                <div class="cell">{{save_mod}}</div>
                                {{/abilities.wis}}
                            </div>

                        </div><!--/abilities group -->

                        <div class="abilities-group">

                            <div class="ability header">
                                <div class=""></div>
                                <div class=""></div>
                                <div>MOD</div>
                                <div>SAVE</div>
                            </div>

                            <div class="ability">
                                {{#abilities.con}}
                                <div class="ability-abbr cell">Con</div>
                                <div class="cell">{{score}}</div>
                                <div class="cell">{{mod}}</div>
                                <div class="cell">{{save_mod}}</div>
                                {{/abilities.con}}
                            </div>

                            <div class="ability">
                                {{#abilities.cha}}
                                <span class="ability-abbr cell">Cha</span>
                                <span class="cell">{{score}}</span>
                                <span class="cell">{{mod}}</span>
                                <span class="cell">{{save_mod}}</span>
                                {{/abilities.cha}}
                            </div>

                        </div> <!--/abilities group -->
                    </div>

                    {{#vm.skills}}
                    <div><span class="label">Skills</span> {{vm.skills}}</div>
                    {{/vm.skills}}

                    {{#vm.defenses.vulnerabilities}}
                    <div><span class="label">Vulnerabilities</span> {{vm.defenses.vulnerabilities}}</div>
                    {{/vm.defenses.vulnerabilities}}

                    {{#vm.defenses.resistances}}
                    <div><span class="label">Resistances</span> {{vm.defenses.resistances}}</div>
                    {{/vm.defenses.resistances}}

                    {{#vm.defenses.immunities}}
                    <div><span class="label">Immunities</span> {{vm.defenses.immunities}}</div>
                    {{/vm.defenses.immunities}}

                    <div><span class="label">Senses</span> {{vm.senses}}</div>
                    <div><span class="label">Languages</span> {{vm.languages}}</div>
                    <div><span class="label">CR</span> {{challengeRating}} (XP ?; PB {{vm.proficiencyBonus}})</div>
                </div>

                {{#traits.length}}
                <div class="mt-2">
                    <div class="name">Traits</div>
                    <hr class="mt-0" />
                    {{#traits}}
                    <div class="mb-0.5">
                        <span class="label">{{name}}</span> <span>{{description}}</span>
                    </div>
                    {{/traits}}
                </div>
                {{/traits.length}}

                {{#actions.length}}
                <div class="mt-2">
                    <div class="name">Actions</div>
                    <hr class="mt-0" />
                    {{#actions}}
                    <div class="mb-0.5">
                        <span class="label">{{name}}</span> <span>{{description}}</span>
                    </div>
                    {{/actions}}

                </div>
                {{/actions.length}}

                <!-- todo: move this to actions-->
                {{#vm.attacks.length}}
                <div class="mt-2">
                    <div class="name">Attacks</div>
                    <hr class="mt-0" />
                    {{#vm.attacks}}
                    <div class="mb-0.5">
                        <span class="label">{{name}}</span>
                        <span class="italic">{{range}} Roll:</span> {{attack_mod}}, {{reach}}.
                        <span>Hit:</span> {{damage}} damage.
                        <span>{{description}}</span>
                    </div>
                    {{/vm.attacks}}
                </div>
                {{/vm.attacks.length}}

            </div>

            <!-- todo: other sections such as bonus actions, reactions, legendary actions -->

            <div class="spacer"></div>

            <div class="source-book">
                {{vm.source}}
            </div>

        </div>
    </template>

    <!-- load mbam-webapp scripts here -->
    <!--
    Can't use ES Modules / systemjs because we're trying to keep running this simple.
    Meaning we're avoiding:
    - having to run a build step (nodejs)
    - having to run a local file server
    - the CORS issues that pop up when loading other files from the filesystem
      (can't use <script type=module src="../src/lib.js" )

    Which means we're stuck loading modules via wrapped in IIFE
    that register themselves to a well-known singleton (window.main)
    -->

    <!-- general utility functions -->
    <script src="../src/util/util.js"></script>
    <script src="../src/util/string-util.js"></script>

    <!-- program logic -->
    <script src="../src/main.js"></script>
    <script src="../src/loader.js"></script>
    <script src="../src/character-loader.js"></script>
    <script src="../src/render.js"></script>

    <!-- program logic - formmatters -->
    <script src="../src/formatters/base.js"></script>
    <script src="../src/formatters/attack.js"></script>
    <script src="../src/formatters/monster-card.js"></script>
    <script src="../src/formatters/spell-card.js"></script>


    <script>
        (async () => {
            mpmb.init();
            const result = await main.init();
            main.render(result);
        })()
    </script>

</body>